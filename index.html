<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Coral Alvorada - Kits de Ensaio</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #00111B; /* Cor de fundo principal */
        }
        /* Estilo customizado para as barras de progresso e volume */
        input[type=range]::-webkit-slider-thumb {
            -webkit-appearance: none;
            height: 16px;
            width: 16px;
            border-radius: 50%;
            background: #FC5E1E; /* Laranja */
            cursor: pointer;
            margin-top: -6px; 
            box-shadow: 0 1px 3px rgba(0,0,0,0.4);
        }
        input[type=range]::-moz-range-thumb {
            height: 16px;
            width: 16px;
            border-radius: 50%;
            background: #FC5E1E; /* Laranja */
            cursor: pointer;
            border: none;
            box-shadow: 0 1px 3px rgba(0,0,0,0.4);
        }
        .playlist-item:hover {
            background-color: #264B2F; /* Verde Escuro */
        }
        .playlist-item.playing {
            background-color: #FC5E1E; /* Laranja */
            color: #FFFFFF;
        }
        .loader-icon {
            color: #75FF31; /* Verde Lima */
        }
        #loop-btn.active {
            color: #75FF31; /* Verde Lima */
        }
    </style>
</head>
<body class="text-white flex items-center justify-center min-h-screen p-4">

    <div class="w-full max-w-md bg-[#053D47] rounded-2xl shadow-2xl overflow-hidden">
        
        <!-- Player Display -->
        <div class="p-8 bg-[#053D47]/50 backdrop-blur-sm text-center">
            <div class="flex-1 min-w-0">
                <h2 class="text-xl font-bold" id="current-song-title">Selecione uma música</h2>
            </div>
        </div>

        <!-- Controles e Barra de Progresso -->
        <div class="p-6 bg-[#053D47]">
             <div class="flex items-center justify-between text-xs text-gray-300 mb-2">
                <span id="current-time">0:00</span>
                <span id="duration">0:00</span>
            </div>
            <input type="range" id="progress-bar" value="0" class="w-full h-1.5 bg-[#264B2F] rounded-lg appearance-none cursor-pointer">
           
            <div class="flex items-center justify-between mt-5">
                <!-- Botão de Loop -->
                <button id="loop-btn" class="w-12 h-10 flex items-center justify-center text-gray-300 hover:text-white transition-colors duration-200 active">
                    <i class="fas fa-repeat fa-lg"></i>
                </button>
                
                <!-- Controles Principais -->
                <div class="flex items-center justify-center space-x-5">
                    <button id="prev-btn" class="text-gray-300 hover:text-white transition-colors duration-200">
                        <i class="fas fa-backward-step fa-2x"></i>
                    </button>
                    <button id="play-pause-btn" class="bg-[#FC5E1E] text-white w-16 h-16 rounded-full flex items-center justify-center shadow-lg hover:bg-opacity-80 transition-all duration-200">
                        <i id="play-pause-icon" class="fas fa-play fa-2x"></i>
                    </button>
                    <button id="next-btn" class="text-gray-300 hover:text-white transition-colors duration-200">
                        <i class="fas fa-forward-step fa-2x"></i>
                    </button>
                </div>

                <!-- Controle de Volume -->
                <div class="flex items-center space-x-2 w-1/4">
                    <i id="volume-icon" class="fas fa-volume-high text-gray-300"></i>
                    <input type="range" id="volume-slider" min="0" max="100" value="100" class="w-full h-1.5 bg-[#264B2F] rounded-lg appearance-none cursor-pointer">
                </div>
            </div>
        </div>

        <!-- Playlist -->
        <div class="bg-[#00111B] p-4">
            <h3 class="text-lg font-semibold mb-2 px-2">Playlist</h3>
            <div id="playlist" class="max-h-60 overflow-y-auto">
                <!-- Músicas serão inseridas aqui pelo JavaScript -->
                <div id="loader" class="text-center p-4">
                    <i class="fas fa-spinner fa-spin mr-2 loader-icon"></i> Carregando músicas...
                </div>
            </div>
        </div>
        
        <!-- Footer com instruções -->
        <div class="bg-[#053D47] text-center p-4 text-xs text-gray-400">
            <p>Este site é para uso interno e exclusivo dos membros do Coral Alvorada.</p>
        </div>
    </div>

    <audio id="audio-player" class="hidden"></audio>

    <script>
        // --- CONFIGURAÇÃO ---
        const GITHUB_USER = "glauberlasantiago";
        const GITHUB_REPO = "CoralAlvoradaEnsaio";
        const AUDIO_FOLDER_PATH = ""; // Em branco para usar a pasta raiz

        // --- ELEMENTOS DO DOM ---
        const audioPlayer = document.getElementById('audio-player');
        const playPauseBtn = document.getElementById('play-pause-btn');
        const playPauseIcon = document.getElementById('play-pause-icon');
        const prevBtn = document.getElementById('prev-btn');
        const nextBtn = document.getElementById('next-btn');
        const progressBar = document.getElementById('progress-bar');
        const currentTimeEl = document.getElementById('current-time');
        const durationEl = document.getElementById('duration');
        const currentSongTitleEl = document.getElementById('current-song-title');
        const playlistEl = document.getElementById('playlist');
        const loader = document.getElementById('loader');
        const loopBtn = document.getElementById('loop-btn');
        const volumeSlider = document.getElementById('volume-slider');
        const volumeIcon = document.getElementById('volume-icon');

        // --- ESTADO DO PLAYER ---
        let playlist = [];
        let currentSongIndex = -1;
        let isPlaying = false;
        let isLooping = true;

        // --- INICIALIZAÇÃO DO PLAYER ---
        audioPlayer.loop = isLooping;
        audioPlayer.volume = 1;

        // --- FUNÇÕES DO PLAYER ---

        /**
         * Busca os arquivos de áudio do repositório do GitHub e constrói a playlist.
         */
        async function fetchAndBuildPlaylist() {
            const apiUrl = `https://api.github.com/repos/${GITHUB_USER}/${GITHUB_REPO}/contents/${AUDIO_FOLDER_PATH}`;
            
            try {
                const response = await fetch(apiUrl);
                if (!response.ok) {
                    throw new Error(`Erro ao buscar dados: ${response.statusText}. Verifique as configurações.`);
                }
                const files = await response.json();
                
                playlist = files
                    .filter(file => file.name.toLowerCase().endsWith('.mp3'))
                    .map(file => ({
                        name: file.name.replace('.mp3', '').replace(/_/g, ' ').replace(/-/g, ' - '),
                        url: file.download_url
                    }));

                renderPlaylist();

            } catch (error) {
                console.error("Falha ao carregar a playlist:", error);
                playlistEl.innerHTML = `<div class="text-red-400 p-4 text-center">${error.message}</div>`;
            } finally {
                loader.style.display = 'none';
            }
        }

        /**
         * Renderiza a playlist na interface.
         */
        function renderPlaylist() {
            playlistEl.innerHTML = '';
            if (playlist.length === 0) {
                playlistEl.innerHTML = `<div class="text-gray-400 p-4 text-center">Nenhuma música encontrada.</div>`;
                return;
            }

            playlist.forEach((song, index) => {
                const songItem = document.createElement('div');
                songItem.className = 'playlist-item p-3 rounded-lg cursor-pointer flex items-center transition-colors duration-200';
                songItem.innerHTML = `
                    <span class="flex-1 truncate font-medium">${song.name}</span>
                `;
                songItem.addEventListener('click', () => loadSong(index));
                playlistEl.appendChild(songItem);
            });
        }
        
        /**
         * Carrega uma música pelo seu índice na playlist.
         */
        function loadSong(index) {
            if (index < 0 || index >= playlist.length) return;
            currentSongIndex = index;
            const song = playlist[currentSongIndex];
            audioPlayer.src = song.url;
            currentSongTitleEl.textContent = song.name;
            updatePlayingUI();
            playSong();
        }

        function playSong() {
            isPlaying = true;
            audioPlayer.play();
            playPauseIcon.classList.replace('fa-play', 'fa-pause');
        }

        function pauseSong() {
            isPlaying = false;
            audioPlayer.pause();
            playPauseIcon.classList.replace('fa-pause', 'fa-play');
        }

        function togglePlayPause() {
            if (currentSongIndex === -1 && playlist.length > 0) {
                loadSong(0);
            } else if (playlist.length > 0) {
                isPlaying ? pauseSong() : playSong();
            }
        }

        function playPrevious() {
            if (playlist.length === 0) return;
            const newIndex = (currentSongIndex - 1 + playlist.length) % playlist.length;
            loadSong(newIndex);
        }

        function playNext() {
            if (playlist.length === 0) return;
            const newIndex = (currentSongIndex + 1) % playlist.length;
            loadSong(newIndex);
        }
        
        function updateProgress(e) {
            const { duration, currentTime } = e.srcElement;
            if (duration) {
                progressBar.value = (currentTime / duration) * 100;
                currentTimeEl.textContent = formatTime(currentTime);
                durationEl.textContent = formatTime(duration);
            }
        }
        
        function setProgress() {
            const duration = audioPlayer.duration;
            if (duration) {
                audioPlayer.currentTime = (progressBar.value / 100) * duration;
            }
        }

        function toggleLoop() {
            isLooping = !isLooping;
            audioPlayer.loop = isLooping;
            loopBtn.classList.toggle('active', isLooping);
        }

        function setVolume() {
            const volumeValue = volumeSlider.value / 100;
            audioPlayer.volume = volumeValue;
            
            if (volumeValue === 0) {
                volumeIcon.className = 'fas fa-volume-xmark text-gray-300';
            } else if (volumeValue < 0.5) {
                volumeIcon.className = 'fas fa-volume-low text-gray-300';
            } else {
                volumeIcon.className = 'fas fa-volume-high text-gray-300';
            }
        }

        function updatePlayingUI() {
            document.querySelectorAll('.playlist-item').forEach((item, index) => {
                item.classList.toggle('playing', index === currentSongIndex);
            });
        }

        function formatTime(seconds) {
            const minutes = Math.floor(seconds / 60);
            const secs = Math.floor(seconds % 60);
            return `${minutes}:${secs < 10 ? '0' : ''}${secs}`;
        }

        // --- EVENT LISTENERS ---
        playPauseBtn.addEventListener('click', togglePlayPause);
        prevBtn.addEventListener('click', playPrevious);
        nextBtn.addEventListener('click', playNext);
        loopBtn.addEventListener('click', toggleLoop);
        volumeSlider.addEventListener('input', setVolume);
        audioPlayer.addEventListener('timeupdate', updateProgress);
        audioPlayer.addEventListener('ended', playNext);
        progressBar.addEventListener('input', setProgress);
        document.addEventListener('DOMContentLoaded', fetchAndBuildPlaylist);

    </script>
</body>
</html>
